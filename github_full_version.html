<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåŠŸèƒ½ç¿»è¯‘å·¥å…· - GitHubç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        nav {
            margin-top: 20px;
        }
        
        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
            gap: 10px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s;
        }
        
        nav a.active, nav a:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* æ–‡å­—ç¿»è¯‘æ ·å¼ */
        .language-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        select {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }
        
        .arrow {
            font-size: 24px;
            margin: 0 15px;
            color: #666;
        }
        
        .swap-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 15px;
        }
        
        .swap-btn:hover {
            background: #5a6fd8;
        }
        
        .text-areas {
            display: flex;
            height: 400px;
        }
        
        .text-area {
            flex: 1;
            padding: 20px;
            border: none;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .text-area:focus {
            outline: none;
        }
        
        .left-panel {
            border-right: 1px solid #e9ecef;
        }
        
        .left-panel .text-area {
            background: #f8f9fa;
        }
        
        .right-panel .text-area {
            background: white;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .translate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .translate-btn:hover {
            transform: translateY(-2px);
        }
        
        .translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .action-btn:hover {
            background: #5a6268;
        }
        
        .stats {
            padding: 10px 20px;
            background: #e9ecef;
            color: #666;
            font-size: 14px;
            text-align: right;
        }
        
        /* æ–‡æ¡£/å›¾ç‰‡ç¿»è¯‘æ ·å¼ */
        .upload-section {
            text-align: center;
            padding: 40px 20px;
        }
        
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 20px;
            margin: 20px 0;
            background: #fafafa;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.drag-over {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-icon {
            font-size: 64px;
            color: #ccc;
            margin-bottom: 20px;
        }
        
        .upload-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            color: #999;
            font-size: 14px;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .file-list {
            margin-top: 30px;
            text-align: left;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .file-size {
            color: #666;
            font-size: 14px;
        }
        
        .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .remove-file:hover {
            background: #c82333;
        }
        
        .doc-controls {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .doc-output {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            background: #f8f9fa;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        @media (max-width: 768px) {
            .text-areas {
                flex-direction: column;
                height: auto;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .language-selector {
                flex-direction: column;
                gap: 10px;
            }
            
            .text-area {
                height: 200px !important;
            }
            
            nav ul {
                flex-direction: column;
                align-items: center;
            }
            
            .doc-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ å¤šåŠŸèƒ½ç¿»è¯‘å·¥å…·</h1>
            <p>æ”¯æŒæ–‡å­—ã€æ–‡æ¡£ã€å›¾ç‰‡ç¿»è¯‘çš„å…¨èƒ½ç¿»è¯‘å™¨</p>
            <nav>
                <ul>
                    <li><a href="#" class="tab-link active" data-tab="text">æ–‡å­—ç¿»è¯‘</a></li>
                    <li><a href="#" class="tab-link" data-tab="doc">æ–‡æ¡£/å›¾ç‰‡ç¿»è¯‘</a></li>
                </ul>
            </nav>
        </header>
        
        <!-- æ–‡å­—ç¿»è¯‘æ ‡ç­¾ -->
        <div id="text-translate" class="tab-content active">
            <div class="language-selector">
                <select id="sourceLang">
                    <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en" selected>è‹±è¯­</option>
                    <option value="ja">æ—¥è¯­</option>
                    <option value="ko">éŸ©è¯­</option>
                    <option value="fr">æ³•è¯­</option>
                    <option value="es">è¥¿ç­ç‰™è¯­</option>
                    <option value="ru">ä¿„è¯­</option>
                    <option value="de">å¾·è¯­</option>
                    <option value="it">æ„å¤§åˆ©è¯­</option>
                    <option value="pt">è‘¡è„ç‰™è¯­</option>
                </select>
                
                <div class="arrow">â‡„</div>
                
                <select id="targetLang">
                    <option value="zh" selected>ä¸­æ–‡</option>
                    <option value="en">è‹±è¯­</option>
                    <option value="ja">æ—¥è¯­</option>
                    <option value="ko">éŸ©è¯­</option>
                    <option value="fr">æ³•è¯­</option>
                    <option value="es">è¥¿ç­ç‰™è¯­</option>
                    <option value="ru">ä¿„è¯­</option>
                    <option value="de">å¾·è¯­</option>
                    <option value="it">æ„å¤§åˆ©è¯­</option>
                    <option value="pt">è‘¡è„ç‰™è¯­</option>
                </select>
                
                <button class="swap-btn" onclick="swapLanguages()">ğŸ”„ äº¤æ¢</button>
            </div>
            
            <div class="text-areas">
                <div class="left-panel">
                    <textarea 
                        id="sourceText" 
                        class="text-area" 
                        placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬..."
                        oninput="handleTextInput()"
                    ></textarea>
                </div>
                <div class="right-panel">
                    <textarea 
                        id="targetText" 
                        class="text-area" 
                        placeholder="ç¿»è¯‘ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º..."
                        readonly
                    ></textarea>
                </div>
            </div>
            
            <div class="controls">
                <div class="action-buttons">
                    <button class="action-btn" onclick="copyText()">ğŸ“‹ å¤åˆ¶</button>
                    <button class="action-btn" onclick="clearText()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    <button class="action-btn" onclick="speakText('source')">ğŸ”Š æœ—è¯»åŸæ–‡</button>
                    <button class="action-btn" onclick="speakText('target')">ğŸ”Š æœ—è¯»è¯‘æ–‡</button>
                </div>
                
                <button class="translate-btn" id="translateBtn" onclick="translateText()">
                    ğŸ”„ ç¿»è¯‘
                </button>
            </div>
            
            <div class="stats">
                <span id="charCount">å­—ç¬¦æ•°: 0</span> | 
                <span id="wordCount">è¯æ•°: 0</span>
            </div>
        </div>
        
        <!-- æ–‡æ¡£/å›¾ç‰‡ç¿»è¯‘æ ‡ç­¾ -->
        <div id="doc-translate" class="tab-content">
            <div class="upload-section">
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                    <div class="upload-hint">æ”¯æŒæ–‡æ¡£: .docx, .txt | æ”¯æŒå›¾ç‰‡: .jpg, .png, .gif</div>
                    <button class="upload-btn">é€‰æ‹©æ–‡ä»¶</button>
                </div>
                
                <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
                
                <div class="language-selector" style="justify-content: center;">
                    <label>ç›®æ ‡è¯­è¨€: </label>
                    <select id="docTargetLang">
                        <option value="zh" selected>ä¸­æ–‡</option>
                        <option value="en">è‹±è¯­</option>
                        <option value="ja">æ—¥è¯­</option>
                        <option value="ko">éŸ©è¯­</option>
                        <option value="fr">æ³•è¯­</option>
                        <option value="es">è¥¿ç­ç‰™è¯­</option>
                        <option value="ru">ä¿„è¯­</option>
                        <option value="de">å¾·è¯­</option>
                        <option value="it">æ„å¤§åˆ©è¯­</option>
                        <option value="pt">è‘¡è„ç‰™è¯­</option>
                    </select>
                </div>
                
                <div class="file-list" id="fileList">
                    <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <div class="doc-controls">
                    <button class="action-btn" onclick="clearFiles()">ğŸ—‘ï¸ æ¸…ç©ºæ–‡ä»¶</button>
                    <button class="translate-btn" onclick="translateDocuments()">
                        ğŸ”„ å¼€å§‹ç¿»è¯‘
                    </button>
                </div>
                
                <div class="doc-output" id="docOutput">
                    ç¿»è¯‘ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let currentTab = 'text';
        let selectedFiles = [];
        
        // é€šçŸ¥å‡½æ•°
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ ‡ç­¾åˆ‡æ¢
        document.querySelectorAll('.tab-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                link.classList.add('active');
                const tabId = link.getAttribute('data-tab');
                document.getElementById(`${tabId}-translate`).classList.add('active');
                
                currentTab = tabId;
            });
        });

        // æ–‡å­—ç¿»è¯‘åŠŸèƒ½
        let isTranslating = false;

        function handleTextInput() {
            updateStats();
        }

        function updateStats() {
            const text = document.getElementById('sourceText').value;
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            document.getElementById('charCount').textContent = `å­—ç¬¦æ•°: ${charCount}`;
            document.getElementById('wordCount').textContent = `è¯æ•°: ${wordCount}`;
        }

        async function translateText() {
            if (isTranslating) return;
            
            const sourceText = document.getElementById('sourceText').value.trim();
            const sourceLang = document.getElementById('sourceLang').value;
            const targetLang = document.getElementById('targetLang').value;
            
            if (!sourceText) {
                document.getElementById('targetText').value = '';
                return;
            }

            if (sourceLang === targetLang) {
                document.getElementById('targetText').value = sourceText;
                showNotification('æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€ç›¸åŒ');
                return;
            }

            isTranslating = true;
            const btn = document.getElementById('translateBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> ç¿»è¯‘ä¸­...';

            try {
                // ä½¿ç”¨å…è´¹çš„LibreTranslate API
                const response = await fetch('https://libretranslate.com/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        q: sourceText,
                        source: sourceLang === 'auto' ? 'auto' : getLibreLangCode(sourceLang),
                        target: getLibreLangCode(targetLang),
                        format: 'text'
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                document.getElementById('targetText').value = data.translatedText;
                showNotification('ç¿»è¯‘å®Œæˆï¼');
            } catch (error) {
                console.error('ç¿»è¯‘é”™è¯¯:', error);
                
                // å¦‚æœLibreTranslate APIå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¦ä¸€ä¸ªå…è´¹API
                try {
                    // å°è¯•ä½¿ç”¨Google Translateçš„éå®˜æ–¹API
                    const encodedText = encodeURIComponent(sourceText);
                    const apiUrl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${getGoogleLangCode(sourceLang)}&tl=${getGoogleLangCode(targetLang)}&dt=t&q=${encodedText}`;
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    if (data && data[0]) {
                        let result = '';
                        for (let i = 0; i < data[0].length; i++) {
                            if (data[0][i] && data[0][i][0]) {
                                result += data[0][i][0];
                            }
                        }
                        document.getElementById('targetText').value = result || 'ç¿»è¯‘å¤±è´¥';
                        showNotification('ç¿»è¯‘å®Œæˆï¼');
                    } else {
                        throw new Error('æ— æ³•è§£æç¿»è¯‘ç»“æœ');
                    }
                } catch (secondError) {
                    console.error('å¤‡ç”¨APIä¹Ÿå¤±è´¥:', secondError);
                    document.getElementById('targetText').value = `ç¿»è¯‘å¤±è´¥: ${error.message}`;
                    showNotification('ç¿»è¯‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', true);
                }
            } finally {
                isTranslating = false;
                btn.disabled = false;
                btn.innerHTML = 'ğŸ”„ ç¿»è¯‘';
            }
        }

        function swapLanguages() {
            const sourceSelect = document.getElementById('sourceLang');
            const targetSelect = document.getElementById('targetLang');
            const sourceText = document.getElementById('sourceText').value;
            const targetText = document.getElementById('targetText').value;
            
            // äº¤æ¢è¯­è¨€é€‰æ‹©
            const tempLang = sourceSelect.value;
            sourceSelect.value = targetSelect.value;
            targetSelect.value = tempLang;
            
            // äº¤æ¢æ–‡æœ¬
            document.getElementById('sourceText').value = targetText;
            document.getElementById('targetText').value = sourceText;
            
            // è§¦å‘ç¿»è¯‘
            if (targetText) {
                translateText();
            }
        }

        function copyText() {
            const targetText = document.getElementById('targetText').value;
            if (targetText) {
                navigator.clipboard.writeText(targetText).then(() => {
                    showNotification('ç¿»è¯‘ç»“æœå·²å¤åˆ¶ï¼');
                }).catch(err => {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = targetText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('ç¿»è¯‘ç»“æœå·²å¤åˆ¶ï¼');
                });
            } else {
                showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„ç¿»è¯‘ç»“æœï¼', true);
            }
        }

        function clearText() {
            document.getElementById('sourceText').value = '';
            document.getElementById('targetText').value = '';
            updateStats();
        }

        function speakText(type) {
            const text = type === 'source' ? 
                document.getElementById('sourceText').value : 
                document.getElementById('targetText').value;
                
            if (text && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                showNotification('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼', true);
            }
        }

        // æ–‡æ¡£/å›¾ç‰‡ç¿»è¯‘åŠŸèƒ½
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                uploadArea.classList.add('drag-over');
            }

            function unhighlight() {
                uploadArea.classList.remove('drag-over');
            }

            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©ç›¸åŒæ–‡ä»¶
            event.target.value = '';
        }

        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (isValidFileType(file)) {
                    addFileToList(file);
                } else {
                    showNotification(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.name}`, true);
                }
            }
        }

        function isValidFileType(file) {
            const fileName = file.name.toLowerCase();
            const ext = '.' + fileName.split('.').pop();
            const supportedTypes = ['.docx', '.txt', '.jpg', '.jpeg', '.png', '.gif'];
            return supportedTypes.includes(ext);
        }

        function addFileToList(file) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ–‡ä»¶
            if (selectedFiles.some(f => f.name === file.name)) {
                showNotification(`æ–‡ä»¶å·²å­˜åœ¨: ${file.name}`, true);
                return;
            }

            selectedFiles.push(file);
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const ext = '.' + file.name.split('.').pop().toLowerCase();
                let fileType = 'æœªçŸ¥æ–‡ä»¶';
                if (['.docx', '.txt'].includes(ext)) {
                    fileType = 'æ–‡æ¡£';
                } else if (['.jpg', '.jpeg', '.png', '.gif'].includes(ext)) {
                    fileType = 'å›¾ç‰‡';
                }

                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${fileType} | ${(file.size / 1024).toFixed(2)} KB</div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">ç§»é™¤</button>
                `;
                
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        function clearFiles() {
            selectedFiles = [];
            updateFileList();
            showNotification('æ–‡ä»¶åˆ—è¡¨å·²æ¸…ç©º');
        }

        async function translateDocuments() {
            if (selectedFiles.length === 0) {
                showNotification('è¯·é€‰æ‹©è¦ç¿»è¯‘çš„æ–‡ä»¶', true);
                return;
            }

            const targetLang = document.getElementById('docTargetLang').value;
            const outputArea = document.getElementById('docOutput');
            outputArea.innerHTML = 'æ­£åœ¨å¤„ç†æ–‡ä»¶...';

            try {
                let allResults = [];
                for (const file of selectedFiles) {
                    const result = await processFile(file, targetLang);
                    allResults.push(`<h3>æ–‡ä»¶: ${file.name}</h3><pre>${result}</pre><hr>`);
                }
                
                outputArea.innerHTML = allResults.join('');
                showNotification('æ–‡ä»¶ç¿»è¯‘å®Œæˆï¼');
            } catch (error) {
                console.error('æ–‡æ¡£å¤„ç†é”™è¯¯:', error);
                outputArea.innerHTML = `æ–‡æ¡£å¤„ç†å¤±è´¥: ${error.message}`;
                showNotification('æ–‡æ¡£å¤„ç†å¤±è´¥', true);
            }
        }

        async function processFile(file, targetLang) {
            const fileName = file.name.toLowerCase();
            const ext = '.' + fileName.split('.').pop();

            if (['.jpg', '.jpeg', '.png', '.gif'].includes(ext)) {
                // å›¾ç‰‡å¤„ç†ï¼šæ¨¡æ‹ŸOCRå’Œç¿»è¯‘
                return await processImage(file, targetLang);
            } else if (['.docx', '.txt'].includes(ext)) {
                // æ–‡æ¡£å¤„ç†ï¼šè¯»å–å†…å®¹å¹¶ç¿»è¯‘
                return await processDocument(file, targetLang);
            } else {
                throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${ext}`);
            }
        }

        async function processImage(file, targetLang) {
            // æ¨¡æ‹ŸOCRå¤„ç†
            const ocrResult = `å›¾ç‰‡ "${file.name}" ä¸­æ£€æµ‹åˆ°çš„æ–‡æœ¬ï¼š\n\n[ç¤ºä¾‹æ–‡æœ¬ - åœ¨å®é™…ç¯å¢ƒä¸­ä¼šé€šè¿‡OCRæŠ€æœ¯æå–çœŸå®æ–‡æœ¬]\n\nè¿™æ˜¯ä¸€æ®µä»å›¾ç‰‡ä¸­æå–çš„ç¤ºä¾‹æ–‡æœ¬ï¼Œå°†è¢«ç¿»è¯‘æˆ${getLanguageName(targetLang)}ã€‚`;
            
            // ç¿»è¯‘OCRç»“æœ
            try {
                const response = await fetch('https://libretranslate.com/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        q: ocrResult,
                        source: 'zh',
                        target: getLibreLangCode(targetLang),
                        format: 'text'
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                return data.translatedText;
            } catch (error) {
                return `${ocrResult}\n\n[æ³¨æ„ï¼šå›¾ç‰‡ç¿»è¯‘éœ€è¦OCRæŠ€æœ¯æ”¯æŒï¼Œåœ¨æ­¤ç¯å¢ƒä¸­ä»…åšæ¼”ç¤º]`;
            }
        }

        async function processDocument(file, targetLang) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        let content = '';
                        
                        if (file.name.toLowerCase().endsWith('.txt')) {
                            content = e.target.result;
                        } else {
                            // å¯¹äº.docxæ–‡ä»¶ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
                            content = `[${file.name}] æ–‡æ¡£å†…å®¹ç¤ºä¾‹\n\nè¿™æ˜¯ä»æ–‡æ¡£ä¸­æå–çš„ç¤ºä¾‹å†…å®¹ï¼Œå®é™…åº”ç”¨ä¸­ä¼šä½¿ç”¨ä¸“ä¸šçš„æ–‡æ¡£è§£æåº“æ¥æå–çœŸå®å†…å®¹ã€‚\n\nä»¥ä¸‹æ˜¯ç¿»è¯‘æˆ${getLanguageName(targetLang)}çš„ç»“æœï¼š\n\n[æ–‡æ¡£å†…å®¹å°†è¢«ç¿»è¯‘]`;
                        }
                        
                        if (content.length > 5000) { // å¦‚æœå†…å®¹å¤ªé•¿ï¼Œåˆ†æ‰¹å¤„ç†
                            resolve(splitAndTranslate(content, targetLang));
                        } else {
                            // ç¿»è¯‘æ–‡æ¡£å†…å®¹
                            const response = await fetch('https://libretranslate.com/translate', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    q: content,
                                    source: 'auto',
                                    target: getLibreLangCode(targetLang),
                                    format: 'text'
                                })
                            });

                            if (!response.ok) {
                                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                            }

                            const data = await response.json();
                            resolve(data.translatedText);
                        }
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                
                // æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©è¯»å–æ–¹å¼
                if (file.name.toLowerCase().endsWith('.txt')) {
                    reader.readAsText(file, 'utf-8');
                } else {
                    // å¯¹äº.docxç­‰æ ¼å¼ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
                    resolve(`[${file.name}] æ–‡æ¡£éœ€è¦ä¸“ä¸šè§£æåº“æ¥è¯»å–å†…å®¹ï¼Œæ­¤å¤„ä¸ºæ¨¡æ‹Ÿç»“æœã€‚\n\nåœ¨å®é™…éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œä¼šä½¿ç”¨ä¸“ä¸šçš„æ–‡æ¡£è§£ææŠ€æœ¯æ¥æå–çœŸå®å†…å®¹å¹¶è¿›è¡Œç¿»è¯‘ã€‚`);
                }
            });
        }

        async function splitAndTranslate(text, targetLang) {
            // å°†é•¿æ–‡æœ¬åˆ†å‰²æˆè¾ƒå°çš„éƒ¨åˆ†è¿›è¡Œç¿»è¯‘
            const maxLength = 4500; // APIå•æ¬¡è¯·æ±‚é•¿åº¦é™åˆ¶
            const parts = [];
            const translatedParts = [];

            // æŒ‰å¥å­æˆ–æ®µè½åˆ†å‰²æ–‡æœ¬
            let currentPart = '';
            const sentences = text.match(/[^\.!?]+[\.!?]+/g) || [text];

            for (const sentence of sentences) {
                if ((currentPart + sentence).length > maxLength) {
                    if (currentPart) {
                        parts.push(currentPart.trim());
                        currentPart = sentence;
                    } else {
                        // å•ä¸ªå¥å­å°±è¶…è¿‡é™åˆ¶ï¼ŒæŒ‰å­—ç¬¦åˆ†å‰²
                        const chunks = splitTextByLength(sentence, maxLength);
                        parts.push(...chunks);
                    }
                } else {
                    currentPart += sentence;
                }
            }

            if (currentPart) {
                parts.push(currentPart.trim());
            }

            // é€éƒ¨åˆ†ç¿»è¯‘
            for (const part of parts) {
                if (part) {
                    const response = await fetch('https://libretranslate.com/translate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            q: part,
                            source: 'auto',
                            target: getLibreLangCode(targetLang),
                            format: 'text'
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                    }

                    const data = await response.json();
                    translatedParts.push(data.translatedText);
                }
            }

            return translatedParts.join('\n\n');
        }

        function splitTextByLength(text, maxLength) {
            const parts = [];
            for (let i = 0; i < text.length; i += maxLength) {
                parts.push(text.substring(i, i + maxLength));
            }
            return parts;
        }

        // è¯­è¨€ä»£ç æ˜ å°„
        function getLibreLangCode(code) {
            const map = {
                'zh': 'zh',
                'en': 'en',
                'ja': 'ja',
                'ko': 'ko',
                'fr': 'fr',
                'es': 'es',
                'ru': 'ru',
                'de': 'de',
                'it': 'it',
                'pt': 'pt'
            };
            return map[code] || 'en';
        }

        function getGoogleLangCode(code) {
            const map = {
                'zh': 'zh-CN',
                'en': 'en',
                'ja': 'ja',
                'ko': 'ko',
                'fr': 'fr',
                'es': 'es',
                'ru': 'ru',
                'de': 'de',
                'it': 'it',
                'pt': 'pt'
            };
            return map[code] || 'en';
        }

        function getLanguageName(code) {
            const map = {
                'zh': 'ä¸­æ–‡',
                'en': 'è‹±è¯­',
                'ja': 'æ—¥è¯­',
                'ko': 'éŸ©è¯­',
                'fr': 'æ³•è¯­',
                'es': 'è¥¿ç­ç‰™è¯­',
                'ru': 'ä¿„è¯­',
                'de': 'å¾·è¯­',
                'it': 'æ„å¤§åˆ©è¯­',
                'pt': 'è‘¡è„ç‰™è¯­'
            };
            return map[code] || 'æœªçŸ¥è¯­è¨€';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            setupDragAndDrop();
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter' && currentTab === 'text') {
                    translateText();
                }
            });
        });
    </script>
</body>
</html>